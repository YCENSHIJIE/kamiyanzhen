<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>å¡å¯†éªŒè¯ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Microsoft YaHei', sans-serif; }
        body { background: #0a0f1e; padding: 30px; }
        .container { max-width: 1200px; margin: 0 auto; background: #1a1f2e; border-radius: 16px; padding: 30px; border: 1px solid #00cc99; }
        h1 { color: #00ffaa; font-size: 28px; margin-bottom: 20px; border-bottom: 2px solid #00cc99; padding-bottom: 15px; }
        .url-box { background: #0f1422; padding: 20px; border-radius: 12px; margin-bottom: 30px; border-left: 6px solid #00ffaa; }
        .url { background: #000; color: #00ffaa; padding: 15px; border-radius: 8px; font-size: 18px; word-break: break-all; }
        .stats { display: grid; grid-template-columns: repeat(4,1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #0f1422; padding: 20px; border-radius: 12px; border-left: 6px solid #00ffaa; }
        .stat-card h3 { color: #aaffdd; font-size: 14px; }
        .stat-card span { color: #fff; font-size: 28px; font-weight: bold; }
        .card-list { background: #0b0e16; border-radius: 12px; padding: 20px; max-height: 400px; overflow-y: auto; }
        .card-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #2a3344; color: #fff; }
        .btn { padding: 10px 24px; border-radius: 8px; border: none; cursor: pointer; margin: 0 5px; }
        .btn-primary { background: #00cc99; color: #000; }
        .btn-warning { background: #ffaa00; color: #000; }
        .btn-danger { background: #ff5555; color: #fff; }
        .input-field { background: #0f1422; border: 1px solid #00cc99; border-radius: 8px; padding: 12px; color: #fff; width: 200px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ å¡å¯†ç®¡ç†ç³»ç»Ÿ Â· æœ€ç»ˆç‰ˆ</h1>
        
        <div class="url-box">
            <h3 style="color: #00ffaa;">ğŸŒ C++ å¯¹æ¥åœ°å€</h3>
            <div class="url" id="apiUrl">æ­£åœ¨è·å–...</div>
        </div>

        <div class="stats">
            <div class="stat-card"><h3>æ€»å¡å¯†</h3><span id="statTotal">0</span></div>
            <div class="stat-card"><h3>å·²ç»‘å®š</h3><span id="statBound">0</span></div>
            <div class="stat-card"><h3>æœªç»‘å®š</h3><span id="statUnbound">0</span></div>
            <div class="stat-card"><h3>æ°¸ä¹…å¡</h3><span id="statPermanent">0</span></div>
        </div>

        <div style="margin: 20px 0;">
            <h2>ğŸ« ç”Ÿæˆå¡å¯†</h2>
            <select id="cardType" class="input-field" style="width: 120px;">
                <option value="day">å¤©å¡</option>
                <option value="week">å‘¨å¡</option>
                <option value="month">æœˆå¡</option>
                <option value="permanent">æ°¸ä¹…å¡</option>
            </select>
            <input type="number" id="genCount" class="input-field" value="1" min="1" max="10" style="width: 100px;">
            <button class="btn btn-primary" onclick="generateCards()">ç”Ÿæˆ</button>
        </div>

        <div style="margin: 20px 0;">
            <h2>âœï¸ ç¼–è¾‘å¡å¯†</h2>
            <input type="text" id="editCard" class="input-field" placeholder="å¡å¯†" style="width: 200px;">
            <select id="editType" class="input-field" style="width: 120px;">
                <option value="day">å¤©å¡</option>
                <option value="week">å‘¨å¡</option>
                <option value="month">æœˆå¡</option>
                <option value="permanent">æ°¸ä¹…å¡</option>
            </select>
            <button class="btn btn-warning" onclick="editCard()">ç¼–è¾‘</button>
        </div>

        <div style="margin: 20px 0;">
            <h2>ğŸ”„ è§£ç»‘/æ¢ç»‘</h2>
            <input type="text" id="opCard" class="input-field" placeholder="å¡å¯†" style="width: 200px;">
            <input type="text" id="newDevice" class="input-field" placeholder="æ–°è®¾å¤‡ID" style="width: 200px;">
            <button class="btn btn-danger" onclick="unbindCard()">è§£ç»‘</button>
            <button class="btn btn-primary" onclick="rebindCard()">æ¢ç»‘</button>
        </div>

        <h2>ğŸ“‹ å¡å¯†åˆ—è¡¨</h2>
        <div class="card-list" id="cardList"></div>
    </div>

    <script>
        // ========== æœ¬åœ°æ•°æ®åº“ ==========
        let cards = JSON.parse(localStorage.getItem('final_cards')) || {
            "DAY-A1B2C": { card: "DAY-A1B2C", type: "day", device: "", status: "unbound" },
            "WEEK-1234": { card: "WEEK-1234", type: "week", device: "PC-001", status: "bound" },
            "MONTH-2024": { card: "MONTH-2024", type: "month", device: "", status: "unbound" },
            "PERM-8888": { card: "PERM-8888", type: "permanent", device: "SERVER-01", status: "bound" }
        };

        // ä¿å­˜æ•°æ®
        function saveCards() {
            localStorage.setItem('final_cards', JSON.stringify(cards));
        }

        // åˆå§‹åŒ–
        function init() {
            // æ˜¾ç¤ºAPIåœ°å€
            let url = window.location.href.split('?')[0];
            document.getElementById('apiUrl').innerText = url + '?card=å¡å¯†';
            
            // å¤„ç†APIè¯·æ±‚
            let params = new URLSearchParams(window.location.search);
            let card = params.get('card');
            
            if (card) {
                let found = cards[card];
                let result = found || { success: false, message: 'å¡å¯†ä¸å­˜åœ¨' };
                document.write(JSON.stringify(result));
                document.close();
                return;
            }
            
            renderCards();
        }

        // æ¸²æŸ“å¡å¯†åˆ—è¡¨
        function renderCards() {
            let html = '';
            let total = 0, bound = 0, unbound = 0, perm = 0;
            
            Object.keys(cards).forEach(key => {
                let c = cards[key];
                total++;
                if (c.status === 'bound') bound++;
                else unbound++;
                if (c.type === 'permanent') perm++;
                
                html += `<div class="card-item">
                    <div>
                        <span style="color: #88ff88; margin-right: 20px;">${c.card}</span>
                        <span style="color: #88ddff; margin-right: 20px;">${c.type}</span>
                        <span style="color: #ffaa88; margin-right: 20px;">${c.device || 'æ— '}</span>
                        <span style="color: ${c.status === 'bound' ? '#88ffaa' : '#ccc'};">${c.status === 'bound' ? 'å·²ç»‘å®š' : 'æœªç»‘å®š'}</span>
                    </div>
                    <div>
                        <button onclick="deleteCard('${c.card}')" style="background: #ff5555; color: white; border: none; padding: 5px 10px; border-radius: 4px;">åˆ é™¤</button>
                    </div>
                </div>`;
            });
            
            document.getElementById('cardList').innerHTML = html || '<div style="color: #888; padding: 50px; text-align: center;">æš‚æ— å¡å¯†</div>';
            document.getElementById('statTotal').innerText = total;
            document.getElementById('statBound').innerText = bound;
            document.getElementById('statUnbound').innerText = unbound;
            document.getElementById('statPermanent').innerText = perm;
        }

        // ç”Ÿæˆå¡å¯†
        function generateCards() {
            let type = document.getElementById('cardType').value;
            let count = parseInt(document.getElementById('genCount').value);
            let prefix = {day:'DAY', week:'WEEK', month:'MONTH', permanent:'PERM'}[type];
            
            for (let i = 0; i < count; i++) {
                let rand = Math.random().toString(36).substring(2, 8).toUpperCase();
                let newCard = `${prefix}-${rand}`;
                cards[newCard] = { card: newCard, type: type, device: '', status: 'unbound' };
            }
            
            saveCards();
            renderCards();
            alert(`âœ… ç”Ÿæˆ ${count} å¼ å¡å¯†`);
        }

        // ç¼–è¾‘å¡å¯†
        function editCard() {
            let card = document.getElementById('editCard').value;
            let type = document.getElementById('editType').value;
            if (cards[card]) {
                cards[card].type = type;
                saveCards();
                renderCards();
                alert('âœ… ç¼–è¾‘æˆåŠŸ');
            } else {
                alert('âŒ å¡å¯†ä¸å­˜åœ¨');
            }
        }

        // åˆ é™¤å¡å¯†
        function deleteCard(card) {
            if (confirm(`ç¡®å®šåˆ é™¤ ${card} å—ï¼Ÿ`)) {
                delete cards[card];
                saveCards();
                renderCards();
            }
        }

        // è§£ç»‘
        function unbindCard() {
            let card = document.getElementById('opCard').value;
            if (cards[card]) {
                cards[card].device = '';
                cards[card].status = 'unbound';
                saveCards();
                renderCards();
                alert('âœ… è§£ç»‘æˆåŠŸ');
            } else {
                alert('âŒ å¡å¯†ä¸å­˜åœ¨');
            }
        }

        // æ¢ç»‘
        function rebindCard() {
            let card = document.getElementById('opCard').value;
            let device = document.getElementById('newDevice').value;
            if (!device) return alert('âŒ è¯·è¾“å…¥è®¾å¤‡ID');
            if (cards[card]) {
                cards[card].device = device;
                cards[card].status = 'bound';
                saveCards();
                renderCards();
                alert('âœ… æ¢ç»‘æˆåŠŸ');
            } else {
                alert('âŒ å¡å¯†ä¸å­˜åœ¨');
            }
        }

        // å¯åŠ¨
        init();
    </script>
</body>
</html>
